
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://tenebrisnoctua.github.io/ServerAuthority/examples/character/">
      
      
        <link rel="prev" href="../">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Character Movement System - Server Authority Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/colors.css">
    
      <link rel="stylesheet" href="../../css/theme.css">
    
      <link rel="stylesheet" href="../../css/code.css">
    
      <link rel="stylesheet" href="../../css/api-reference.css">
    
      <link rel="stylesheet" href="../../css/paragraph.css">
    
      <link rel="stylesheet" href="../../css/home.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="pedoc-dark" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#character-movement-system" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Server Authority Documentation" class="md-header__button md-logo" aria-label="Server Authority Documentation" data-md-component="logo">
      <!-- Logo -->

  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Server Authority Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Character Movement System
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="pedoc-dark" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to Light Mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to Light Mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 19a7 7 0 1 1 0-14 7 7 0 0 1 0 14m0-1.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 1 0 0 11m-5.657.157a.75.75 0 0 1 0 1.06l-1.768 1.768a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.767-1.768a.75.75 0 0 1 1.061 0M3.515 3.515a.75.75 0 0 1 1.06 0l1.768 1.768a.749.749 0 0 1-.326 1.275.75.75 0 0 1-.734-.215L3.515 4.575a.75.75 0 0 1 0-1.06M12 0a.75.75 0 0 1 .75.75v2.5a.75.75 0 0 1-1.5 0V.75A.75.75 0 0 1 12 0M4 12a.75.75 0 0 1-.75.75H.75a.75.75 0 0 1 0-1.5h2.5A.75.75 0 0 1 4 12m8 8a.75.75 0 0 1 .75.75v2.5a.75.75 0 0 1-1.5 0v-2.5A.75.75 0 0 1 12 20m12-8a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h2.5A.75.75 0 0 1 24 12m-6.343 5.657a.75.75 0 0 1 1.06 0l1.768 1.768a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-1.768-1.767a.75.75 0 0 1 0-1.061m2.828-14.142a.75.75 0 0 1 0 1.06l-1.768 1.768a.75.75 0 0 1-1.042-.018.75.75 0 0 1-.018-1.042l1.767-1.768a.75.75 0 0 1 1.061 0"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="pedoc-light" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch To Dark Mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch To Dark Mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.768 3.96zl-.002-.005a9 9 0 0 0-.218-.779c-.13-.394.21-.8.602-.67q.435.144.855.328l.01.005A10.002 10.002 0 0 1 12 22a10 10 0 0 1-9.162-5.985l-.004-.01a10 10 0 0 1-.329-.855c-.13-.392.277-.732.67-.602q.386.126.78.218l.004.002A9 9 0 0 0 14.999 6a9 9 0 0 0-.231-2.04M16.5 6c0 5.799-4.701 10.5-10.5 10.5q-.64 0-1.26-.075A8.5 8.5 0 1 0 16.425 4.74q.075.62.075 1.259Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
    
  
  Server Authority

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Examples

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Server Authority Documentation" class="md-nav__button md-logo" aria-label="Server Authority Documentation" data-md-component="logo">
      <!-- Logo -->

  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Server Authority Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Server Authority
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Server Authority
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/aurora/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Services and Behaviors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../main/credits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Credits
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Character Movement System
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Character Movement System
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-design" class="md-nav__link">
    <span class="md-ellipsis">
      The Design
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-modular-way" class="md-nav__link">
    <span class="md-ellipsis">
      Default (Modular) Way
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Default (Modular) Way">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#charactermovement" class="md-nav__link">
    <span class="md-ellipsis">
      CharacterMovement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charactermovement_1" class="md-nav__link">
    <span class="md-ellipsis">
      CharacterMovement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serversetup" class="md-nav__link">
    <span class="md-ellipsis">
      ServerSetup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clientsetup" class="md-nav__link">
    <span class="md-ellipsis">
      ClientSetup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camerainput" class="md-nav__link">
    <span class="md-ellipsis">
      CameraInput
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behavior-way" class="md-nav__link">
    <span class="md-ellipsis">
      Behavior Way
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Behavior Way">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#charactermovement_2" class="md-nav__link">
    <span class="md-ellipsis">
      CharacterMovement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charactermovement_3" class="md-nav__link">
    <span class="md-ellipsis">
      CharacterMovement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serversetup_1" class="md-nav__link">
    <span class="md-ellipsis">
      ServerSetup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camerainput_1" class="md-nav__link">
    <span class="md-ellipsis">
      CameraInput
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-design" class="md-nav__link">
    <span class="md-ellipsis">
      The Design
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-modular-way" class="md-nav__link">
    <span class="md-ellipsis">
      Default (Modular) Way
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Default (Modular) Way">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#charactermovement" class="md-nav__link">
    <span class="md-ellipsis">
      CharacterMovement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charactermovement_1" class="md-nav__link">
    <span class="md-ellipsis">
      CharacterMovement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serversetup" class="md-nav__link">
    <span class="md-ellipsis">
      ServerSetup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clientsetup" class="md-nav__link">
    <span class="md-ellipsis">
      ClientSetup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camerainput" class="md-nav__link">
    <span class="md-ellipsis">
      CameraInput
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behavior-way" class="md-nav__link">
    <span class="md-ellipsis">
      Behavior Way
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Behavior Way">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#charactermovement_2" class="md-nav__link">
    <span class="md-ellipsis">
      CharacterMovement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charactermovement_3" class="md-nav__link">
    <span class="md-ellipsis">
      CharacterMovement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serversetup_1" class="md-nav__link">
    <span class="md-ellipsis">
      ServerSetup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camerainput_1" class="md-nav__link">
    <span class="md-ellipsis">
      CameraInput
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="character-movement-system">Character Movement System</h1>
<p>This is an example character movement system that you can create with Server Authority.</p>
<h2 id="the-design">The Design</h2>
<p>In a server-authoritative model, the same code must run on both the Server and the Client. This is how the client predicts what the server will do. To achieve this, we have two options: We can use <code>ModuleScript</code>s to do it in a modular way, or we can use the new <code>AuroraScript</code> object to do it all in one script architecture.</p>
<h2 id="default-modular-way">Default (Modular) Way</h2>
<p>First, under the "ServerAuthority" folder in <code>ReplicatedStorage</code>, we create a <code>ModuleScript</code> named "CharacterMovement". This will be our main module which will contain the movement system. It will be used both by the server and the client.</p>
<p>The hierarchy should look like this:</p>
<p><img alt="hierarchy_1" src="../../img/tutorial/character/hierarchyimage_1.png" /></p>
<p>Then, in this module, we connect to the <code>RunService.FixedHeartbeat(deltaTime: number)</code> signal with a callback function.</p>
<h3 id="charactermovement">CharacterMovement</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kd">local</span><span class="w"> </span><span class="nv">RunService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;RunService&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">MovementModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="nv">Connections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="p">{</span><span class="nc">RBXScriptConnection</span><span class="p">}</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">}</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w"> </span><span class="c1">-- This function begins the movement calculation for a player.</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="kr">function</span><span class="w"> </span><span class="nc">MovementModule</span><span class="p">.</span><span class="nf">BeginMovement</span><span class="p">(</span><span class="nv">player</span><span class="p">:</span><span class="w"> </span><span class="nc">Player</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="c1">-- We connect to the .FixedHeartbeat event of RunService, and add the Connection object to the Connections table to track it.</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="nv">MovementModule</span><span class="p">.</span><span class="nv">Connections</span><span class="p">[</span><span class="nv">player</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">RunService</span><span class="p">.</span><span class="nv">FixedHeartbeat</span><span class="p">:</span><span class="nc">Connect</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="nv">deltaTime</span><span class="p">:</span><span class="w"> </span><span class="nc">number</span><span class="p">)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">        </span><span class="c1">-- This will be the function to start calculating the movement of a player&#39;s character in.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="kr">end</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="c1">-- This function stops the movement calculation for a player.</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="kr">function</span><span class="w"> </span><span class="nc">MovementModule</span><span class="p">.</span><span class="nf">EndMovement</span><span class="p">(</span><span class="nv">player</span><span class="p">:</span><span class="w"> </span><span class="nc">Player</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">FoundConnection</span><span class="p">:</span><span class="w"> </span><span class="nc">RBXScriptConnection</span><span class="err">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MovementModule</span><span class="p">.</span><span class="nv">Connections</span><span class="p">[</span><span class="nv">player</span><span class="p">]</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">FoundConnection</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">    </span><span class="nv">FoundConnection</span><span class="p">:</span><span class="nc">Disconnect</span><span class="p">()</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">    </span><span class="nv">MovementModule</span><span class="p">.</span><span class="nv">Connections</span><span class="p">[</span><span class="nv">player</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="kr">end</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="kr">return</span><span class="w"> </span><span class="nv">MovementModule</span>
</code></pre></div>
<p>We now have a simple initial system that allows us to connect to the <code>.FixedHeartbeat</code> signal. Before we continue to write the actual calculation system however, we need to create some new <code>Instance</code>s to get the input from the player.</p>
<p>To do this, we create another folder called "Input" and create an <code>InputContext</code> with certain <code>InputAction</code>s parented to it, allowing us to get movement input from the player's client.</p>
<p>We will create 4 <code>InputAction</code>s under this <code>InputContext</code>, called: "Camera", "Jump", "Move", "Rotation".
To support both gamepad and keyboard input, we create two <code>InputBinding</code>s under the "Jump" and "Move" <code>InputAction</code>s.</p>
<p>For the "Jump" <code>InputAction</code> (<code>Bool</code> Type), we will add the <code>Space</code> KeyCode to first <code>InputBinding</code>, called "KeyboardBinding". And for the next one, which we can call "GamepadBinding", we add the <code>ButtonA</code> KeyCode.</p>
<p>For the "Move" <code>InputAction</code> (<code>Direction2D</code> Type), we will add 4 directions to the first <code>InputBinding</code> meant for keyboard, called "KeyboardBinding":</p>
<ul>
<li>Down: <code>S</code></li>
<li>Up: <code>W</code></li>
<li>Left: <code>A</code></li>
<li>Right: <code>D</code></li>
</ul>
<p>For the next <code>InputBinding</code>, called "GamepadBinding", we will set the KeyCode to <code>Thumbstick 1</code>.</p>
<p>The hierarchy should now look like this:</p>
<p><img alt="hierarchy_2" src="../../img/tutorial/character/hierarchyimage_2.png" /></p>
<p>We will be cloning this input system to the player object with a script later.</p>
<p>We can now move on to creating the actual system which will calculate the movement for the character.</p>
<h3 id="charactermovement_1">CharacterMovement</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kd">local</span><span class="w"> </span><span class="nv">RunService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;RunService&quot;</span><span class="p">)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">MovementModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="nv">Connections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="p">{</span><span class="nc">RBXScriptConnection</span><span class="p">}</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="p">}</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w"> </span><span class="c1">-- This is the function that begins the movement calculation for a player.</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="kr">function</span><span class="w"> </span><span class="nc">MovementModule</span><span class="p">.</span><span class="nf">BeginMovement</span><span class="p">(</span><span class="nv">player</span><span class="p">:</span><span class="w"> </span><span class="nc">Player</span><span class="p">)</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="c1">-- We connect to the .FixedHeartbeat event of RunService, and add the Connection object to the Connections table to track it.</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="nv">MovementModule</span><span class="p">.</span><span class="nv">Connections</span><span class="p">[</span><span class="nv">player</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">RunService</span><span class="p">.</span><span class="nv">FixedHeartbeat</span><span class="p">:</span><span class="nc">Connect</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="nv">deltaTime</span><span class="p">:</span><span class="w"> </span><span class="nc">number</span><span class="p">)</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">player</span><span class="p">.</span><span class="nv">Character</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nv">player</span><span class="p">.</span><span class="nv">CharacterAdded</span><span class="p">:</span><span class="nc">Wait</span><span class="p">()</span><span class="w"> </span><span class="kr">end</span><span class="w"> </span><span class="c1">-- Waiting until there&#39;s a valid character model.</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">Character</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">player</span><span class="p">.</span><span class="nv">Character</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">Humanoid</span><span class="p">:</span><span class="w"> </span><span class="nc">Humanoid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Character</span><span class="p">.</span><span class="nv">Humanoid</span><span class="w"> </span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">Input</span><span class="p">:</span><span class="w"> </span><span class="nc">InputContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">player</span><span class="p">.</span><span class="nv">Input</span><span class="p">.</span><span class="nv">Default</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">MoveInput</span><span class="p">:</span><span class="w"> </span><span class="nc">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">.</span><span class="nv">Move</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">CameraInput</span><span class="p">:</span><span class="w"> </span><span class="nc">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">.</span><span class="nv">Camera</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">RotationInput</span><span class="p">:</span><span class="w"> </span><span class="nc">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">.</span><span class="nv">Rotation</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">JumpInput</span><span class="p">:</span><span class="w"> </span><span class="nc">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">.</span><span class="nv">Jump</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">        </span><span class="c1">-- Getting the values from InputActions. We use :GetState() here instead of .StateChanged.</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">MoveVector2D</span><span class="p">:</span><span class="w"> </span><span class="nc">Vector2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MoveInput</span><span class="p">:</span><span class="nc">GetState</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">CameraVector2D</span><span class="p">:</span><span class="w"> </span><span class="nc">Vector2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CameraInput</span><span class="p">:</span><span class="nc">GetState</span><span class="p">()</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">RotationIsCameraRelative</span><span class="p">:</span><span class="w"> </span><span class="nc">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">RotationInput</span><span class="p">:</span><span class="nc">GetState</span><span class="p">()</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">JumpBoolean</span><span class="p">:</span><span class="w"> </span><span class="nc">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">JumpInput</span><span class="p">:</span><span class="nc">GetState</span><span class="p">()</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">        </span><span class="c1">-- Calculating the move direction based on camera and movement input.</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">CameraVector3D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Vector3</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nv">CameraVector2D</span><span class="p">.</span><span class="nv">X</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nv">CameraVector2D</span><span class="p">.</span><span class="nv">Y</span><span class="p">)</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">RightVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CameraVector3D</span><span class="p">:</span><span class="nc">Cross</span><span class="p">(</span><span class="nv">Vector3</span><span class="p">.</span><span class="nv">yAxis</span><span class="p">)</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">MoveVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CameraVector3D</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">MoveVector2D</span><span class="p">.</span><span class="nv">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">RightVector</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">MoveVector2D</span><span class="p">.</span><span class="nv">X</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">MoveDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Vector3</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nv">MoveVector</span><span class="p">.</span><span class="nv">X</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nv">MoveVector</span><span class="p">.</span><span class="nv">Z</span><span class="p">)</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">        </span><span class="c1">-- Moving the Humanoid to the target move direction.</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">        </span><span class="nv">Humanoid</span><span class="p">:</span><span class="nc">Move</span><span class="p">(</span><span class="nv">MoveDirection</span><span class="p">)</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="w">        </span><span class="c1">-- Rotating the Character based on camera direction.</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">RotationIsCameraRelative</span><span class="w"> </span><span class="kr">then</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="w">            </span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">AutoRotate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="w">            </span><span class="kr">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">SeatPart</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">RootPart</span><span class="w"> </span><span class="kr">then</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="w">                </span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">RootPart</span><span class="p">.</span><span class="nv">CFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CFrame</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">RootPart</span><span class="p">.</span><span class="nv">CFrame</span><span class="p">.</span><span class="nv">Position</span><span class="p">,</span><span class="w"> </span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">RootPart</span><span class="p">.</span><span class="nv">CFrame</span><span class="p">.</span><span class="nv">Position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">CameraVector3D</span><span class="p">)</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="w">            </span><span class="kr">end</span>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="w">        </span><span class="kr">else</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a><span class="w">            </span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">AutoRotate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a><span class="w">        </span><span class="kr">end</span>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="w">        </span><span class="c1">-- Allowing the Character to jump based on input, and if it&#39;s not currently in-air.</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Humanoid</span><span class="p">:</span><span class="nc">GetState</span><span class="p">()</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">isInAir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">currentState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">HumanoidStateType</span><span class="p">.</span><span class="nv">FallingDown</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a><span class="w">            </span><span class="ow">or</span><span class="w"> </span><span class="nv">currentState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">HumanoidStateType</span><span class="p">.</span><span class="nv">Freefall</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a><span class="w">            </span><span class="ow">or</span><span class="w"> </span><span class="nv">currentState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">HumanoidStateType</span><span class="p">.</span><span class="nv">Jumping</span>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">isInAir</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">JumpBoolean</span><span class="w"> </span><span class="kr">then</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a><span class="w">            </span><span class="nv">Humanoid</span><span class="p">:</span><span class="nc">ChangeState</span><span class="p">(</span><span class="nv">Enum</span><span class="p">.</span><span class="nv">HumanoidStateType</span><span class="p">.</span><span class="nv">Jumping</span><span class="p">)</span>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a><span class="w">        </span><span class="kr">end</span>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a><span class="kr">end</span>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a>
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a><span class="c1">-- This function stops the movement calculation for a player.</span>
<a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a><span class="kr">function</span><span class="w"> </span><span class="nc">MovementModule</span><span class="p">.</span><span class="nf">EndMovement</span><span class="p">(</span><span class="nv">player</span><span class="p">:</span><span class="w"> </span><span class="nc">Player</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">FoundConnection</span><span class="p">:</span><span class="w"> </span><span class="nc">RBXScriptConnection</span><span class="err">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MovementModule</span><span class="p">.</span><span class="nv">Connections</span><span class="p">[</span><span class="nv">player</span><span class="p">]</span>
<a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">FoundConnection</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
<a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a>
<a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a><span class="w">    </span><span class="nv">FoundConnection</span><span class="p">:</span><span class="nc">Disconnect</span><span class="p">()</span>
<a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a><span class="w">    </span><span class="nv">MovementModule</span><span class="p">.</span><span class="nv">Connections</span><span class="p">[</span><span class="nv">player</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a><span class="kr">end</span>
<a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a>
<a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a><span class="kr">return</span><span class="w"> </span><span class="nv">MovementModule</span>
</code></pre></div>
<p>Our system is almost ready! Now, for the system to start working, we need to initialize and run this module from both the server and the client. And we also need to clone and parent the "Input" folder we created above to the player, so the system can start capturing input from the client.</p>
<h3 id="serversetup">ServerSetup</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;Players&quot;</span><span class="p">)</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kd">local</span><span class="w"> </span><span class="nv">ReplicatedStorage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;ReplicatedStorage&quot;</span><span class="p">)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">ServerAuthority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ReplicatedStorage</span><span class="p">.</span><span class="nv">ServerAuthority</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Modules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ServerAuthority</span><span class="p">.</span><span class="nv">Modules</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ServerAuthority</span><span class="p">.</span><span class="nv">Input</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">CharacterMovement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">require</span><span class="p">(</span><span class="nv">Modules</span><span class="p">.</span><span class="nv">CharacterMovement</span><span class="p">)</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="c1">-- This function sets the streaming mode for the character model to Atomic upon character load.</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="kd">local</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="nf">InitializeCharacter</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="w"> </span><span class="nc">Model</span><span class="p">)</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="nv">character</span><span class="p">.</span><span class="nv">ModelStreamingMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">ModelStreamingMode</span><span class="p">.</span><span class="nv">Atomic</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="kr">end</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="c1">-- This function clones and parents the Input folder to the player to start capturing input, and begins the movement calculation.</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="kd">local</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="nf">InitializePlayer</span><span class="p">(</span><span class="nv">player</span><span class="p">:</span><span class="w"> </span><span class="nc">Player</span><span class="p">)</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">player</span><span class="p">.</span><span class="nv">Character</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nf">InitializeCharacter</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nv">Character</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">    </span><span class="nv">player</span><span class="p">.</span><span class="nv">CharacterAdded</span><span class="p">:</span><span class="nc">Connect</span><span class="p">(</span><span class="nv">InitializeCharacter</span><span class="p">)</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">InputTemplate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">:</span><span class="nc">Clone</span><span class="p">()</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">    </span><span class="nv">InputTemplate</span><span class="p">.</span><span class="nv">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">player</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">    </span><span class="nv">CharacterMovement</span><span class="p">.</span><span class="nf">BeginMovement</span><span class="p">(</span><span class="nv">player</span><span class="p">)</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="kr">end</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="c1">-- This function initializes the above functions for all existing players, or new players.</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="kd">local</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="nf">Initialize</span><span class="p">()</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">player</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">Players</span><span class="p">:</span><span class="nc">GetPlayers</span><span class="p">()</span><span class="w"> </span><span class="kr">do</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="w">        </span><span class="nf">InitializePlayer</span><span class="p">(</span><span class="nv">player</span><span class="p">)</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="w">    </span><span class="kr">end</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="w">    </span><span class="nv">Players</span><span class="p">.</span><span class="nv">PlayerAdded</span><span class="p">:</span><span class="nc">Connect</span><span class="p">(</span><span class="nv">InitializePlayer</span><span class="p">)</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="kr">end</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="c1">-- We want to only run the above systems when the AuthorityMode is set to Server. Automatic results in inconsistent behavior.</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="kr">if</span><span class="w"> </span><span class="nv">workspace</span><span class="p">.</span><span class="nv">AuthorityMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">AuthorityMode</span><span class="p">.</span><span class="nv">Server</span><span class="w"> </span><span class="kr">then</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="w">    </span><span class="nf">Initialize</span><span class="p">()</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="kr">end</span>
</code></pre></div>
<p>This is our server script that initializes the movement calculation and input parenting for a player. This is our main system that allows the player to move.</p>
<h3 id="clientsetup">ClientSetup</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;Players&quot;</span><span class="p">)</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kd">local</span><span class="w"> </span><span class="nv">ReplicatedStorage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;ReplicatedStorage&quot;</span><span class="p">)</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">ServerAuthority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ReplicatedStorage</span><span class="p">.</span><span class="nv">ServerAuthority</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Modules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ServerAuthority</span><span class="p">.</span><span class="nv">Modules</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="kd">local</span><span class="w"> </span><span class="nv">CharacterMovement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">require</span><span class="p">(</span><span class="nv">Modules</span><span class="p">.</span><span class="nv">CharacterMovement</span><span class="p">)</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">LocalPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Players</span><span class="p">.</span><span class="nv">LocalPlayer</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="c1">-- This function begins the client prediction for the character.</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="kd">local</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="nf">InitializeCharacter</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="w"> </span><span class="nc">Model</span><span class="p">)</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">HumanoidRootPart</span><span class="p">:</span><span class="w"> </span><span class="nc">Part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">character</span><span class="p">:</span><span class="nc">WaitForChild</span><span class="p">(</span><span class="s2">&quot;HumanoidRootPart&quot;</span><span class="p">)</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">    </span><span class="nv">HumanoidRootPart</span><span class="p">:</span><span class="nc">SetPredictionMode</span><span class="p">(</span><span class="nv">Enum</span><span class="p">.</span><span class="nv">PredictionMode</span><span class="p">.</span><span class="nv">On</span><span class="p">)</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="kr">end</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="c1">-- This function initializes the movement prediction and the character.</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="kd">local</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="nf">Initialize</span><span class="p">()</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">LocalPlayer</span><span class="p">.</span><span class="nv">Character</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nf">InitializeCharacter</span><span class="p">(</span><span class="nv">LocalPlayer</span><span class="p">.</span><span class="nv">Character</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">    </span><span class="nv">LocalPlayer</span><span class="p">.</span><span class="nv">CharacterAdded</span><span class="p">:</span><span class="nc">Connect</span><span class="p">(</span><span class="nv">InitializeCharacter</span><span class="p">)</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">    </span><span class="nv">CharacterMovement</span><span class="p">.</span><span class="nf">BeginMovement</span><span class="p">(</span><span class="nv">LocalPlayer</span><span class="p">)</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="kr">end</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="c1">-- We want to only run the above systems when the AuthorityMode is set to Server. Automatic results in inconsistent behavior.</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="kr">if</span><span class="w"> </span><span class="nv">workspace</span><span class="p">.</span><span class="nv">AuthorityMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">AuthorityMode</span><span class="p">.</span><span class="nv">Server</span><span class="w"> </span><span class="kr">then</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="w">    </span><span class="nf">Initialize</span><span class="p">()</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="kr">end</span>
</code></pre></div>
<p>This is our client script that initializes the movement prediction for a player. This is our main system that allows a smooth experience for the player movement.</p>
<p>However, we also need to create another client script to capture input for the camera:</p>
<h3 id="camerainput">CameraInput</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;Players&quot;</span><span class="p">)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kd">local</span><span class="w"> </span><span class="nv">RunService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;RunService&quot;</span><span class="p">)</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">UserGameSetting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">UserSettings</span><span class="p">():</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;UserGameSettings&quot;</span><span class="p">)</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">LocalPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Players</span><span class="p">.</span><span class="nv">LocalPlayer</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c1">-- Defining the InputActions for the camera and rotation.</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">LocalPlayer</span><span class="p">:</span><span class="nc">WaitForChild</span><span class="p">(</span><span class="s2">&quot;Input&quot;</span><span class="p">)</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="kd">local</span><span class="w"> </span><span class="nv">CameraInput</span><span class="p">:</span><span class="w"> </span><span class="nc">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">.</span><span class="nv">Default</span><span class="p">.</span><span class="nv">Camera</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="kd">local</span><span class="w"> </span><span class="nv">RotationInput</span><span class="p">:</span><span class="w"> </span><span class="nc">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">.</span><span class="nv">Default</span><span class="p">.</span><span class="nv">Rotation</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="kr">if</span><span class="w"> </span><span class="nv">workspace</span><span class="p">.</span><span class="nv">AuthorityMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">AuthorityMode</span><span class="p">.</span><span class="nv">Server</span><span class="w"> </span><span class="kr">then</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">    </span><span class="c1">-- This callback function calculates the current rotation of the character and the camera, and sends it to the server.</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">    </span><span class="nv">RunService</span><span class="p">:</span><span class="nc">BindToRenderStep</span><span class="p">(</span><span class="s2">&quot;CameraInput&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">RenderPriority</span><span class="p">.</span><span class="nv">Last</span><span class="p">.</span><span class="nv">Value</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">Camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">workspace</span><span class="p">.</span><span class="nv">CurrentCamera</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">YAxis</span><span class="p">:</span><span class="w"> </span><span class="nc">Vector3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Vector3</span><span class="p">.</span><span class="nv">yAxis</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">Forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">YAxis</span><span class="p">:</span><span class="nc">Cross</span><span class="p">(</span><span class="nv">Camera</span><span class="p">.</span><span class="nv">CFrame</span><span class="p">.</span><span class="nv">RightVector</span><span class="p">)</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">        </span><span class="nv">CameraInput</span><span class="p">:</span><span class="nc">Fire</span><span class="p">(</span><span class="nv">Vector2</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nv">Forward</span><span class="p">.</span><span class="nv">X</span><span class="p">,</span><span class="w"> </span><span class="nv">Forward</span><span class="p">.</span><span class="nv">Z</span><span class="p">))</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">        </span><span class="nv">RotationInput</span><span class="p">:</span><span class="nc">Fire</span><span class="p">(</span><span class="nv">UserGameSetting</span><span class="p">.</span><span class="nv">RotationType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">RotationType</span><span class="p">.</span><span class="nv">CameraRelative</span><span class="p">)</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="kr">end</span>
</code></pre></div>
<p>After everything above has been complete, our new system hierarchy should now look like this:</p>
<p><img alt="hierarchy_3" src="../../img/tutorial/character/hierarchyimage_3.png" /></p>
<p>And that's all! Hitting the "Play" button should allow you to test our new system. This new character system provides a secure and accurate character simulation, while behaving smoothly for the player's view.</p>
<hr />
<h2 id="behavior-way">Behavior Way</h2>
<p>While the modular system works, it is not fully desirable as it requires us to create loaders from both the server and the client, and a module script which runs the movement system. To make make it more desirable and easier for us to create Server Authority systems, there exists a new <code>Instance</code> called <code>AuroraScript</code>. This new instance allows us to define a behavior which will both run on the server and the client.</p>
<p>To learn more about Behaviors, check out the <a href="../../main/aurora/">Services and Behaviors</a> section.</p>
<p>First we create a new <code>AuroraScript</code> called "CharacterMovement". This will be our main script which will contain the movement system.</p>
<h3 id="charactermovement_2">CharacterMovement</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kd">local</span><span class="w"> </span><span class="nv">RunService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;RunService&quot;</span><span class="p">)</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;Players&quot;</span><span class="p">)</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kr">type</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="nc">Instance</span><span class="p">:</span><span class="w"> </span><span class="nc">Instance</span><span class="p">,</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="nc">Frame</span><span class="p">:</span><span class="w"> </span><span class="nc">number</span><span class="p">,</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="nc">LODLevel</span><span class="p">:</span><span class="w"> </span><span class="nc">number</span><span class="p">,</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="nc">Connect</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nc">signal</span><span class="p">:</span><span class="w"> </span><span class="nc">RBXScriptSignal</span><span class="p">,</span><span class="w"> </span><span class="nc">functionName</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">RBXScriptConnection</span><span class="p">,</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="nc">Subscribe</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nc">topic</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="nc">functionName</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">    </span><span class="nc">Publish</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nc">topic</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nc">any</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">any</span><span class="p">,</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="nc">SendMessage</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nc">boundInstance</span><span class="p">:</span><span class="w"> </span><span class="nc">Instance</span><span class="p">,</span><span class="w"> </span><span class="nc">behaviorName</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="nc">functionName</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nc">any</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p">...</span><span class="nc">any</span><span class="p">,</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="nc">Delay</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nc">amount</span><span class="p">:</span><span class="w"> </span><span class="nc">number</span><span class="p">,</span><span class="w"> </span><span class="nc">functionName</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="nc">SetMaxFrequency</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nc">frequency</span><span class="p">:</span><span class="w"> </span><span class="nc">number</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">number</span><span class="p">,</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">    </span><span class="p">[</span><span class="nc">string</span><span class="p">]:</span><span class="w"> </span><span class="nc">any</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="p">}</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="c1">-- This function runs when the Behavior starts.</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="kr">function</span><span class="w"> </span><span class="nc">Behavior</span><span class="p">.</span><span class="nf">OnStart</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">)</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">    </span><span class="c1">-- We connect to the .FixedHeartbeat event of RunService here to DefaultMovement function of the Behavior.</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nc">Connect</span><span class="p">(</span><span class="nv">RunService</span><span class="p">.</span><span class="nv">FixedHeartbeat</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DefaultMovement&quot;</span><span class="p">)</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="nv">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Players</span><span class="p">:</span><span class="nc">GetPlayerFromCharacter</span><span class="p">(</span><span class="nv">self</span><span class="p">.</span><span class="nv">Instance</span><span class="p">)</span><span class="w"> </span><span class="c1">-- We find the Player from the bound Character instance and set it as a value within our Behavior.</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="kr">end</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="kr">function</span><span class="w"> </span><span class="nc">Behavior</span><span class="p">.</span><span class="nf">DefaultMovement</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nv">deltaTime</span><span class="p">:</span><span class="w"> </span><span class="nc">number</span><span class="p">)</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">    </span><span class="c1">-- This function runs when .FixedHeartbeat fires with the deltaTime argument.</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="kr">end</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="c1">-- We declare a field in our Behavior to store the Player instance.</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="nv">Behavior</span><span class="p">.</span><span class="nf">DeclareField</span><span class="p">(</span><span class="s2">&quot;Player&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;instance&quot;</span><span class="p">})</span>
</code></pre></div>
<p>We now have a simple initial system that allows us to connect to the <code>.FixedHeartbeat</code> signal and set our Player property.</p>
<p>However, just like in the modular way, we need to create an input system to capture input from the client.
Repeating the steps from <a href="#default-modular-way">Modular Way</a>, we now have a hierarchy like this:</p>
<p><img alt="hierarchy_4" src="../../img/tutorial/character/hierarchyimage_4.png" /></p>
<p>We can now move on to creating the actual system which will calculate the movement for the character.</p>
<h3 id="charactermovement_3">CharacterMovement</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kd">local</span><span class="w"> </span><span class="nv">RunService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;RunService&quot;</span><span class="p">)</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;Players&quot;</span><span class="p">)</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="kr">type</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="nc">Instance</span><span class="p">:</span><span class="w"> </span><span class="nc">Instance</span><span class="p">,</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="nc">Frame</span><span class="p">:</span><span class="w"> </span><span class="nc">number</span><span class="p">,</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="nc">LODLevel</span><span class="p">:</span><span class="w"> </span><span class="nc">number</span><span class="p">,</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="nc">Connect</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nc">signal</span><span class="p">:</span><span class="w"> </span><span class="nc">RBXScriptSignal</span><span class="p">,</span><span class="w"> </span><span class="nc">functionName</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">RBXScriptConnection</span><span class="p">,</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="nc">Subscribe</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nc">topic</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="nc">functionName</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="nc">Publish</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nc">topic</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nc">any</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">any</span><span class="p">,</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">    </span><span class="nc">SendMessage</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nc">boundInstance</span><span class="p">:</span><span class="w"> </span><span class="nc">Instance</span><span class="p">,</span><span class="w"> </span><span class="nc">behaviorName</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="nc">functionName</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nc">any</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p">...</span><span class="nc">any</span><span class="p">,</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="nc">Delay</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nc">amount</span><span class="p">:</span><span class="w"> </span><span class="nc">number</span><span class="p">,</span><span class="w"> </span><span class="nc">functionName</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">string</span><span class="p">,</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">    </span><span class="nc">SetMaxFrequency</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nc">frequency</span><span class="p">:</span><span class="w"> </span><span class="nc">number</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">number</span><span class="p">,</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="p">[</span><span class="nc">string</span><span class="p">]:</span><span class="w"> </span><span class="nc">any</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="p">}</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="c1">-- This function runs when the Behavior starts.</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="kr">function</span><span class="w"> </span><span class="nc">Behavior</span><span class="p">.</span><span class="nf">OnStart</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">)</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">    </span><span class="c1">-- We connect to the .FixedHeartbeat event of RunService here to DefaultMovement function of the Behavior.</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nc">Connect</span><span class="p">(</span><span class="nv">RunService</span><span class="p">.</span><span class="nv">FixedHeartbeat</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DefaultMovement&quot;</span><span class="p">)</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="nv">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Players</span><span class="p">:</span><span class="nc">GetPlayerFromCharacter</span><span class="p">(</span><span class="nv">self</span><span class="p">.</span><span class="nv">Instance</span><span class="p">)</span><span class="w"> </span><span class="c1">-- We find the Player from the bound Character instance and set it as a value within our Behavior.</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="kr">end</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="kr">function</span><span class="w"> </span><span class="nc">Behavior</span><span class="p">.</span><span class="nf">DefaultMovement</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="w"> </span><span class="nc">AuroraScriptObject</span><span class="p">,</span><span class="w"> </span><span class="nv">deltaTime</span><span class="p">:</span><span class="w"> </span><span class="nc">number</span><span class="p">)</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="w">    </span><span class="c1">-- This function runs when .FixedHeartbeat fires with the deltaTime argument.</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">Character</span><span class="p">:</span><span class="w"> </span><span class="nc">Model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="nv">Instance</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">Player</span><span class="p">:</span><span class="w"> </span><span class="nc">Player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="nv">Player</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">Player</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">Humanoid</span><span class="p">:</span><span class="w"> </span><span class="nc">Humanoid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Character</span><span class="p">:</span><span class="nc">WaitForChild</span><span class="p">(</span><span class="s2">&quot;Humanoid&quot;</span><span class="p">)</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">Input</span><span class="p">:</span><span class="w"> </span><span class="nc">InputContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Player</span><span class="p">.</span><span class="nv">Input</span><span class="p">.</span><span class="nv">Default</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">MoveInput</span><span class="p">:</span><span class="w"> </span><span class="nc">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">.</span><span class="nv">Move</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">CameraInput</span><span class="p">:</span><span class="w"> </span><span class="nc">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">.</span><span class="nv">Camera</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">RotationInput</span><span class="p">:</span><span class="w"> </span><span class="nc">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">.</span><span class="nv">Rotation</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">JumpInput</span><span class="p">:</span><span class="w"> </span><span class="nc">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">.</span><span class="nv">Jump</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="w">    </span><span class="c1">-- Getting the values from InputActions. We use :GetState() here instead of .StateChanged.</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">MoveVector2D</span><span class="p">:</span><span class="w"> </span><span class="nc">Vector2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MoveInput</span><span class="p">:</span><span class="nc">GetState</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">CameraVector2D</span><span class="p">:</span><span class="w"> </span><span class="nc">Vector2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CameraInput</span><span class="p">:</span><span class="nc">GetState</span><span class="p">()</span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">RotationIsCameraRelative</span><span class="p">:</span><span class="w"> </span><span class="nc">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">RotationInput</span><span class="p">:</span><span class="nc">GetState</span><span class="p">()</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">JumpBoolean</span><span class="p">:</span><span class="w"> </span><span class="nc">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">JumpInput</span><span class="p">:</span><span class="nc">GetState</span><span class="p">()</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="w">    </span><span class="c1">-- Calculating the move direction based on camera and movement input.</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">CameraVector3D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Vector3</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nv">CameraVector2D</span><span class="p">.</span><span class="nv">X</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nv">CameraVector2D</span><span class="p">.</span><span class="nv">Y</span><span class="p">)</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">RightVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CameraVector3D</span><span class="p">:</span><span class="nc">Cross</span><span class="p">(</span><span class="nv">Vector3</span><span class="p">.</span><span class="nv">yAxis</span><span class="p">)</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">MoveVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CameraVector3D</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">MoveVector2D</span><span class="p">.</span><span class="nv">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">RightVector</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">MoveVector2D</span><span class="p">.</span><span class="nv">X</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">MoveDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Vector3</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nv">MoveVector</span><span class="p">.</span><span class="nv">X</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nv">MoveVector</span><span class="p">.</span><span class="nv">Z</span><span class="p">)</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="w">    </span><span class="c1">-- Moving the Humanoid to the target move direction.</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="w">    </span><span class="nv">Humanoid</span><span class="p">:</span><span class="nc">Move</span><span class="p">(</span><span class="nv">MoveDirection</span><span class="p">)</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="w">    </span><span class="c1">-- Rotating the Character based on camera direction.</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">RotationIsCameraRelative</span><span class="w"> </span><span class="kr">then</span>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="w">        </span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">AutoRotate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">SeatPart</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">RootPart</span><span class="w"> </span><span class="kr">then</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="w">            </span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">RootPart</span><span class="p">.</span><span class="nv">CFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CFrame</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">RootPart</span><span class="p">.</span><span class="nv">CFrame</span><span class="p">.</span><span class="nv">Position</span><span class="p">,</span><span class="w"> </span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">RootPart</span><span class="p">.</span><span class="nv">CFrame</span><span class="p">.</span><span class="nv">Position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">CameraVector3D</span><span class="p">)</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a><span class="w">        </span><span class="kr">end</span>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="w">    </span><span class="kr">else</span>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a><span class="w">        </span><span class="nv">Humanoid</span><span class="p">.</span><span class="nv">AutoRotate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a><span class="w">    </span><span class="kr">end</span>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a><span class="w">    </span><span class="c1">-- Allowing the Character to jump based on input, and if it&#39;s not currently in-air.</span>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">currentState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Humanoid</span><span class="p">:</span><span class="nc">GetState</span><span class="p">()</span>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">isInAir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">currentState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">HumanoidStateType</span><span class="p">.</span><span class="nv">FallingDown</span>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a><span class="w">        </span><span class="ow">or</span><span class="w"> </span><span class="nv">currentState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">HumanoidStateType</span><span class="p">.</span><span class="nv">Freefall</span>
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a><span class="w">        </span><span class="ow">or</span><span class="w"> </span><span class="nv">currentState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">HumanoidStateType</span><span class="p">.</span><span class="nv">Jumping</span>
<a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">isInAir</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">JumpBoolean</span><span class="w"> </span><span class="kr">then</span>
<a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a><span class="w">        </span><span class="nv">Humanoid</span><span class="p">:</span><span class="nc">ChangeState</span><span class="p">(</span><span class="nv">Enum</span><span class="p">.</span><span class="nv">HumanoidStateType</span><span class="p">.</span><span class="nv">Jumping</span><span class="p">)</span>
<a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a><span class="w">    </span><span class="kr">end</span>
<a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a><span class="kr">end</span>
<a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a>
<a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a><span class="c1">-- We declare a field in our Behavior to store the Player instance.</span>
<a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a><span class="nv">Behavior</span><span class="p">.</span><span class="nf">DeclareField</span><span class="p">(</span><span class="s2">&quot;Player&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;instance&quot;</span><span class="p">})</span>
</code></pre></div>
<p>Our behavior is now done! This behavior will now run when it has been bound to a player's character. To do this however, we need to manually bind it upon character load on the server. For this, we can add a <code>Script</code> called "ServerSetup".</p>
<h3 id="serversetup_1">ServerSetup</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;Players&quot;</span><span class="p">)</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kd">local</span><span class="w"> </span><span class="nv">ReplicatedStorage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;ReplicatedStorage&quot;</span><span class="p">)</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="kd">local</span><span class="w"> </span><span class="nv">ServerAuthority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ReplicatedStorage</span><span class="p">.</span><span class="nv">ServerAuthority</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Scripts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ServerAuthority</span><span class="p">.</span><span class="nv">Scripts</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ServerAuthority</span><span class="p">.</span><span class="nv">Input</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="c1">-- This function sets the streaming mode for the character model to Atomic, and binds the character to the behavior upon load.</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="kd">local</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="nf">InitializeCharacter</span><span class="p">(</span><span class="nv">character</span><span class="p">:</span><span class="w"> </span><span class="nc">Model</span><span class="p">)</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="nv">character</span><span class="p">.</span><span class="nv">ModelStreamingMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">ModelStreamingMode</span><span class="p">.</span><span class="nv">Atomic</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="nv">Scripts</span><span class="p">.</span><span class="nv">Behavior</span><span class="p">:</span><span class="nc">AddTo</span><span class="p">(</span><span class="nv">character</span><span class="p">)</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="kr">end</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="c1">-- This function clones and parents the Input folder to the player to start capturing input.</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="kd">local</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="nf">InitializePlayer</span><span class="p">(</span><span class="nv">player</span><span class="p">:</span><span class="w"> </span><span class="nc">Player</span><span class="p">)</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">player</span><span class="p">.</span><span class="nv">Character</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nf">InitializeCharacter</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nv">Character</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="w">    </span><span class="nv">player</span><span class="p">.</span><span class="nv">CharacterAdded</span><span class="p">:</span><span class="nc">Connect</span><span class="p">(</span><span class="nv">InitializeCharacter</span><span class="p">)</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">InputTemplate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">:</span><span class="nc">Clone</span><span class="p">()</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="w">    </span><span class="nv">InputTemplate</span><span class="p">.</span><span class="nv">Parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">player</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="kr">end</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="c1">-- This function initializes the above functions for all existing players, or new players.</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="kd">local</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="nf">Initialize</span><span class="p">()</span>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">player</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">Players</span><span class="p">:</span><span class="nc">GetPlayers</span><span class="p">()</span><span class="w"> </span><span class="kr">do</span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="w">        </span><span class="nf">InitializePlayer</span><span class="p">(</span><span class="nv">player</span><span class="p">)</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="w">    </span><span class="kr">end</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a><span class="w">    </span><span class="nv">Players</span><span class="p">.</span><span class="nv">PlayerAdded</span><span class="p">:</span><span class="nc">Connect</span><span class="p">(</span><span class="nv">InitializePlayer</span><span class="p">)</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="kr">end</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="c1">-- We want to only run the above systems when the AuthorityMode is set to Server. Automatic results in inconsistent behavior.</span>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="kr">if</span><span class="w"> </span><span class="nv">workspace</span><span class="p">.</span><span class="nv">AuthorityMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">AuthorityMode</span><span class="p">.</span><span class="nv">Server</span><span class="w"> </span><span class="kr">then</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="w">    </span><span class="nf">Initialize</span><span class="p">()</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="kr">end</span>
</code></pre></div>
<p>This is our server script that parents the Input folder to a player, and binds the behavior to its character when it loads.</p>
<p>With this system, the character can now move, however, we still need to create a client <code>Script</code> to capture input for the camera:</p>
<h3 id="camerainput_1">CameraInput</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;Players&quot;</span><span class="p">)</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kd">local</span><span class="w"> </span><span class="nv">RunService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">game</span><span class="p">:</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;RunService&quot;</span><span class="p">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kd">local</span><span class="w"> </span><span class="nv">UserGameSetting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">UserSettings</span><span class="p">():</span><span class="nc">GetService</span><span class="p">(</span><span class="s2">&quot;UserGameSettings&quot;</span><span class="p">)</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="kd">local</span><span class="w"> </span><span class="nv">LocalPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Players</span><span class="p">.</span><span class="nv">LocalPlayer</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="c1">-- Defining the InputActions for the camera and rotation.</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="kd">local</span><span class="w"> </span><span class="nv">Input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">LocalPlayer</span><span class="p">:</span><span class="nc">WaitForChild</span><span class="p">(</span><span class="s2">&quot;Input&quot;</span><span class="p">)</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="kd">local</span><span class="w"> </span><span class="nv">CameraInput</span><span class="p">:</span><span class="w"> </span><span class="nc">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">.</span><span class="nv">Default</span><span class="p">.</span><span class="nv">Camera</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="kd">local</span><span class="w"> </span><span class="nv">RotationInput</span><span class="p">:</span><span class="w"> </span><span class="nc">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Input</span><span class="p">.</span><span class="nv">Default</span><span class="p">.</span><span class="nv">Rotation</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="kr">if</span><span class="w"> </span><span class="nv">workspace</span><span class="p">.</span><span class="nv">AuthorityMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">AuthorityMode</span><span class="p">.</span><span class="nv">Server</span><span class="w"> </span><span class="kr">then</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">    </span><span class="c1">-- This callback function calculates the current rotation of the character and the camera, and sends it to the server.</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">    </span><span class="nv">RunService</span><span class="p">:</span><span class="nc">BindToRenderStep</span><span class="p">(</span><span class="s2">&quot;CameraInput&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">RenderPriority</span><span class="p">.</span><span class="nv">Last</span><span class="p">.</span><span class="nv">Value</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">Camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">workspace</span><span class="p">.</span><span class="nv">CurrentCamera</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">YAxis</span><span class="p">:</span><span class="w"> </span><span class="nc">Vector3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Vector3</span><span class="p">.</span><span class="nv">yAxis</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">Forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">YAxis</span><span class="p">:</span><span class="nc">Cross</span><span class="p">(</span><span class="nv">Camera</span><span class="p">.</span><span class="nv">CFrame</span><span class="p">.</span><span class="nv">RightVector</span><span class="p">)</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">        </span><span class="nv">CameraInput</span><span class="p">:</span><span class="nc">Fire</span><span class="p">(</span><span class="nv">Vector2</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nv">Forward</span><span class="p">.</span><span class="nv">X</span><span class="p">,</span><span class="w"> </span><span class="nv">Forward</span><span class="p">.</span><span class="nv">Z</span><span class="p">))</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w">        </span><span class="nv">RotationInput</span><span class="p">:</span><span class="nc">Fire</span><span class="p">(</span><span class="nv">UserGameSetting</span><span class="p">.</span><span class="nv">RotationType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">Enum</span><span class="p">.</span><span class="nv">RotationType</span><span class="p">.</span><span class="nv">CameraRelative</span><span class="p">)</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w">    </span><span class="kr">end</span><span class="p">)</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="kr">end</span>
</code></pre></div>
<p>After everything above has been complete, our new system hierarchy should now look like this:</p>
<p><img alt="hierarchy_5" src="../../img/tutorial/character/hierarchyimage_5.png" /></p>
<p>And that's all! Hitting the "Test" button should allow you to test our new system. This new character system provides a secure and accurate character simulation, while behaving smoothly for the player's view.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Examples">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Examples
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2025 <a href="https://github.com/TenebrisNoctua"  target="_blank" rel="noopener">Tenebris Noctua</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "navigation.footer", "navigation.path", "navigation.indexes", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>